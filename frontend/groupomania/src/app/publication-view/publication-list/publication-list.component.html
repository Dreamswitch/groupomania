<mat-spinner *ngIf="loading"></mat-spinner>

<app-publication-form></app-publication-form>



<p *ngIf="!loading && publications.length <= 0">
  No publications to display!
</p>
<p class="list-title" *ngIf="!loading && publications.length > 0">THE PUBLICATIONS</p>

<mat-card class="publication-card" *ngFor="let publication of publications;let publicationIndex = index;"
  [thePublication]="publication">
  <!--
    condition to display publication
  -->
  <div *ngIf="publicationIndex !== currentPublicationIndex">
    <mat-card-header>
      <img mat-card-avatar *ngIf="publication.user.media" class="user_thumbmail" [src]="publication.user.media"
        alt="profile image of {{publication.user.firstname}}">
      <img mat-card-avatar *ngIf="!publication.user.media" class="user_thumbmail"
        src="../../assets/logos/Profile_avatar_placeholder_large.png" alt="default profile thumbmail">
      <mat-card-title>{{ publication.title | uppercase }}</mat-card-title>
      <mat-card-subtitle>by {{publication.user.firstname}} {{publication.user.lastname}}</mat-card-subtitle>
    </mat-card-header>
    <img mat-card-image [src]="publication.media" alt="Photo of a Shiba Inu">
    <mat-card-content>
      <p>{{publication.body}}</p>
    </mat-card-content>
    <mat-card-actions>
      <button mat-button>LIKE <mat-icon>thumb_up_alt</mat-icon></button>
      <button mat-button>DISLIKE <mat-icon>thumb_down_alt</mat-icon></button>
      <button mat-button (click)="displayCommentForm(publicationIndex);$event.preventDefault()">comment <mat-icon>
          comment
        </mat-icon></button>

      <!--write a new comment-->
      <app-comment-form *ngIf="commentDisplay && currentPublication === publicationIndex"
        (commentDisplayOff)=commentDisplayOff($event) [currentPublication]="publication"></app-comment-form>

      <button mat-flat-button color="accent" *ngIf="publication.isOwner"
        (click)="onModifyPublication(publicationIndex)">modify
        <mat-icon>
          edit</mat-icon></button>
      <button mat-flat-button color="warn" *ngIf="publication.isOwner" (click)="onDeletePublication(publication)">Delete
        <mat-icon>
          delete_forever</mat-icon></button>
    </mat-card-actions>

    <mat-accordion>

      <!-- comment part -->
      <mat-expansion-panel (opened)="panelOpenState = true" (closed)="panelOpenState = false">
        <mat-expansion-panel-header>
          <mat-panel-title>
            {{publication.nbrComments}} {{publication.nbrComments > 1 ? ' comments' : ' comment'}}
          </mat-panel-title>
          <mat-panel-description>
            {{panelOpenState ? 'Hide' : 'View'}} {{publication.nbrComments > 1 ? ' comments' : ' comment'}}
          </mat-panel-description>
        </mat-expansion-panel-header>
        <div *ngFor="let comment of publication.comments;let commentIndex = index">
          <div class="container--comment">
            <mat-card-subtitle>by {{ comment.user.firstname | lowercase }}</mat-card-subtitle>
            <div class="container--mat-image">
              <img mat-card-image *ngIf="comment.media" [src]="comment.media" alt="Photo of a Shiba Inu">
            </div>
            <p>{{comment.body}}</p>
            <!--
              boutons modification/delete comment
            -->
            <button mat-flat-button *ngIf="comment.isOwner"
              (click)="onModifyComment(commentIndex, publicationIndex)">modify
            </button>
            <button mat-flat-button *ngIf="comment.isOwner" (click)="onDeleteComment(comment)">Delete
            </button>

            <!--comment conditionnel-->
            <app-comment-form
              *ngIf="modifyCommentDisplay && commentIndex === currentComment && publicationIndex === currentPublication"
              [currentComment]="comment" (commentDisplayOff)=commentDisplayOff($event)></app-comment-form>

          </div>
        </div>
      </mat-expansion-panel>
    </mat-accordion>

  </div>

  <app-publication-form (currentPublicationIndex)="dataBack($event)"
    *ngIf="modify && publicationIndex === currentPublicationIndex" [currentPublication]="publication"
    [currentPublication]="publication">
  </app-publication-form>

</mat-card>


<!--
<div class="publication-list" *ngIf="!loading && publications.length  > 0">
  <div class="publication-list-item" *ngFor="let publication of publications"
    (click)="onClickSauce(publication.idpublications)">
    <div class="user row">
      <img *ngIf="publication.user.media" class="user_thumbmail" [src]="publication.user.media"
        alt="profile image of {{publication.user.firstname}}">
      <img *ngIf="!publication.user.media" class="user_thumbmail"
        src="../../assets/logos/Profile_avatar_placeholder_large.png" alt="default profile thumbmail">
      <p class="user_name">by {{publication.user.firstname}} {{publication.user.lastname}}</p>
    </div>
    <h4>{{ publication.title | uppercase }}</h4>
    <img [src]="publication.media">
    <p>{{publication.body}}</p>
    <div class="row no-gutters">
      <button mat-flat-button color="accent" *ngIf="publication.idusers === userId">modify</button>
      <button mat-flat-button color="warn" *ngIf="publication.idusers === userId">Delete</button>
    </div>
  </div>
</div>
-->